From 8f5648e829bbb83d1d4f670c232ff8d738dd0cc7 Mon Sep 17 00:00:00 2001
From: Lennart Poettering <lennart@poettering.net>
Date: Tue, 11 Oct 2011 23:53:59 +0200
Subject: [PATCH] atasmart: multiply by sector threshold by 1024 to avoid
 false positives

https://bugs.freedesktop.org/show_bug.cgi?id=25772
---
 atasmart.c |    7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/atasmart.c b/atasmart.c
index 8212059..2cd314f 100644
--- a/atasmart.c
+++ b/atasmart.c
@@ -2285,9 +2285,10 @@ int sk_disk_smart_get_overall(SkDisk *d, SkSmartOverall *overall) {
                 sectors = 0;
         } else {
 
-                /* We use log2(n_sectors) as a threshold here. We had to pick
-                 * something, and this makes a bit of sense, or doesn't it? */
-                sector_threshold = u64log2(d->size/512);
+                /* We use log2(n_sectors)*1024 as a threshold here. We
+                 * had to pick something, and this makes a bit of
+                 * sense, or doesn't it? */
+                sector_threshold = u64log2(d->size/512) * 1024;
 
                 if (sectors >= sector_threshold) {
                         *overall = SK_SMART_OVERALL_BAD_SECTOR_MANY;
-- 
1.7.9.3

